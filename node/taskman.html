<html>
    <head>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    </head>
    <style>
    body, html { 
        background-color: #C6D7B1;
        font-family: 'Open Sans', sans-serif;
    }
    
      .wrapper { 
          width: 450px; 
          margin: 0 auto;
        margin-bottom: 20px;
        }
        .dialogCss{
          max-width: 800px;
        }
    .box {
          padding: 1px 0 1px 0;
          text-align: center; 
          border-radius: 10px 10px 0 0;
          margin-top: 50px;
          color: #EAEDC2;
          text-shadow: 1px 1px 3px #000;
          background-color: #828B6C;
    }
            .main { 
              background-color: #F5F5F5;
              color: #828B6C;
              padding: 1px 5px 10px 10px; 
    }
    .tableCss{
      width:100%
    }
    /* button {
      background: none;
      border: 0px;
      color: #888;
      font-size: 15px;
      width: 60px;
      margin: 10px 0 0;
      font-family: Lato, sans-serif;
      cursor: pointer;
    } */
    
    ul {
      margin: 0;
      padding: 0;
    }
    
    .addtasks {
      margin-bottom: 20px;
    }
    
    .addtasks {
      margin-bottom: 20px;
    }
    
    #createtask { 
      background-color: #828B6C; 
      padding: 5px;
      width: 231px;
      color: #EAEDC2;
      text-align: center;
      cursor: pointer;
    }
    
    li * {
      float: left;
    }
    li, h3 {
      clear:both;
      list-style:none;
    }
  
    label[for='new-task'] {
      color: #333;
      font-weight: 700;
      font-size: 15px;
      border-bottom: 2px solid #333;
      padding: 30px 0 10px;
      margin: 0;
      text-transform: uppercase;
    }
    input[type="text"] {
      margin: 0;
      font-size: 18px;
      line-height: 18px;
      height: 18px;
      padding: 10px;
      border: 1px solid #ddd;
      background: #fff;
      border-radius: 6px;
      font-family: Lato, sans-serif;
      color: #888;
    }
    .taskModificationCss{
      color: gray;
      cursor: pointer;
    }
    input[type="text"]:focus {
      color: #333;
    }
    
    /* New Task */
    label[for='new-task'] {
      display: block;
      margin: 0 0 20px;
    }
    input#new-task {
      float: left;
      width: 318px;
    }
    p > button {
      color: #0FC57C;
    
    }
    
    li {
      overflow: hidden;
      padding: 20px 0;
      border-bottom: 1px solid #eee;
    }
    li > input[type="checkbox"] {
      margin: 0 10px;
      position: relative;
      top: 15px;
    }
    li > label {
      font-size: 18px;
      line-height: 40px;
      width: 237px;
      padding: 0 0 0 11px;
    }
    li >  input[type="text"] {
      width: 226px;
    }
    li > .delete:hover {
      color: #CF2323;
    }
    
    /* Completed */
    #taskcomplete label {
      text-decoration: line-through;
      color: #888;
    }
    
    /* Edit Task */
    ul li input[type=text] {
      display:none;
    }
    
    ul li.editMode input[type=text] {
      display:block;
    }
    
    ul li.editMode label {
      display:none;
    }
    #red {
       color:red;
    }
    #myModal{
text-align: center;
    }
    #title{
        text-align: center; 
    }
    #myModal{
      width:100%;
      align-items: center;
    }
    #footerCss{
      justify-content: space-between;
      width: 100%;
    }
  
</style>
<body>
<div class="wrapper">
  
    <div class="box">
    <h1>Task Manager</h1>
    </div>
  
    <div class="main">
      <div class="addtasks">
      <h2>Add Task</h2>
        <hr>
      </div>
      
      <input type="text" id="tasktext" name="tasktext" placeholder="E.g:TaskName">
  
      <div class="container">
                
                  <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal" id="createtask">+createTask</button>
                 <div class="form-group"> 
               <div class="modal" id="myModal">
                  <div class="modal-dialog dialogCss">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h4 class="text-center">Task manager</h4>
                        <button type="button" class="close" data-dismiss="modal">x</button>
                      </div>
                      <div class="modal-body ml-3 mr-3">
                      <div class="row d-flex">
                        <label for="tname">TaskName</label><span id="red">*<small></small></span>
                        <input type="text" name="taskname"class="form-control" id="task1"><br>
                        
                        <div id="errorTaskName">**This Field is mandatory</div>
                      </div> 
                     
            
           <div class="row d-flex">
            <label for="tdiscription text-center">TaskDiscription</label><span id="red">*<small></small></span>
            <textarea id="task2" name="datadiscription"class="form-control"rows="4" cols="30"></textarea>
            <div id="errorTaskDiscription">**This Field is mandatory</div>
           </div>
               

            </div>
                      <div class="modal-footer">
              <div class="row"id="footerCss">
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                       
                      <button type="submit" class="btn btn-primary mr-2 " id="submit">submit</button> 
                      <button type="button" class="btn btn-primary mr-2" id="edit">Edit</button>
                        
                     </div>
                      </div>
                    </div>
                    </div>
                  </div>
                  <div class="modal" id="deleteTaskModal">
                    <div class="modal-dialog dialogCss">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h4 class="text-center">Delete Task</h4>
                          <button type="button" class="close" data-dismiss="modal">x</button>
                        </div>
                        <div class="modal-body ml-3 mr-3">
                        <div class="row d-flex">
                        <span>Are you sure you want to delete task?</span>
                        </div> 
              </div>
                        <div class="modal-footer">
                <div class="row"id="footerCss">
                          <button type="button" class="btn btn-danger" data-dismiss="modal">No</button>
                         
                        <button type="button" class="btn btn-primary mr-2 " id="deleteTask" data-dismiss="modal">Yes</button>
                       
                
                       </div>
                        </div>
                      </div>
                      </div>
                    </div>
                </div>
                
              </div>
      
          <div class="addedtasks">
              <h2>Current Tasks</h2>
              <hr>
              <div class="row">
                <div class="col-sm-12">
              <div id="taskList">

              </div>
              </div>
            </div>
             
          </div>
      
          <!-- <div class="completedtasks">
            <h2>Completed Tasks</h2>
            <hr>
            <ul id="taskcomplete">
               <li><input type="checkbox" checked><label>See the Doctor</label><input type="text"><button class="edit">Edit</button><button class="delete">Delete</button></li>
            </ul>
          </div> -->
      
    </div>
    
  </div>
  <!-- <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script> -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<!-- <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

  <script>
    var taskList;
    $(document).ready(function(){
      getTaskDetails()
      
      let result = {};
      $("#createtask").click(function(){
        $("#edit").hide();
        $("#submit").show();
        $("#task1").val(" ")
        $("#task2").val(" ")
      })
        $("#errorTaskName").hide();
        $("#errorTaskDiscription").hide();
        $("#submit").click(function(){
            var user=$("#task1").val();
            var disc=$("#task2").val();
              $("#errorTaskName").hide();
              result["taskName"] = user
        
              $("#errorTaskDiscription").hide();
              result["taskDiscription"] = disc
            
          
          
           console.log(result);
           
           if(user != " " && disc != " "){
           $.ajax({
        url:'/task',
        method: "POST",
        data:JSON.stringify(result),
        dataType: 'json',
    contentType: 'application/json',
        success: function (result, status) {
           console.log(result);
           if(result.acknowledged == true){
            $("#myModal").modal('hide')
             getTaskDetails();
           }
        }
      
      });
    }else{
      if(user ==" "){
              $("#errorTaskName").show();
                $("#errorTaskName").css('color','red');
            }
            if(disc==" ")  {
            $("#errorTaskDiscription").show();
            $("#errorTaskDiscription").css('color','red')
            }
    }
    }); 
    })
    function getTaskDetails(){
      $.ajax({
        url:'/getTaskDetails',
        method: "GET",
        success: function (result, status) {
         console.log(result);
         taskList = result;
         html = '';
         if(taskList.length > 0){
          $("#taskList").html('')
            html += '<table class="tableCss"><tr><th>taskname</th></tr>'
            for(i=0;i<taskList.length;i++){
              html+='<tr><td>'+ taskList[i].taskName+'</td><td><span class = "taskModificationCss" onclick="editTaskDetails(\''+taskList[i]._id +'\')">Edit</span></td><td><span class = "taskModificationCss" onclick="deleteTaskDetails(\''+taskList[i]._id +'\')">delete</span></td></tr>'
              
            }
            html+= '</table>'
            $("#taskList").html(html)
         }
        }
      
      });
    }
    function editTaskDetails(id){
      $("#edit").show()
      $("#submit").hide()
      $("#edit").attr("Value",id)
      if(taskList != undefined){
        if(taskList.length>0){
         let newList =  taskList.filter(x=>x._id == id)
         if(newList.length != 0){
           $("#task1").val(newList[0].taskName)
           $("#task2").val(newList[0].taskDiscription)
           $("#myModal").modal("show")
         }
        }
      }
    }
    function deleteTaskDetails(id){
      $("#deleteTask").attr("value",id)
      $("#deleteTaskModal").modal("show")
    }
    $("#deleteTask").on("click",function(){
      var result={
        "_id":$("#deleteTask").attr('value')
      }
      $.ajax({
        url:'/deleteTask',
        method: "POST",
        data:JSON.stringify(result),
        dataType: 'json',
    contentType: 'application/json',
        success: function (result, status) {
           console.log(result);
           if(result.deletedCount != 0){
            getTaskDetails()
           }
          
        }
      
      });
    })
    $("#edit").on("click",function(){
      var result = {};
      $("#errorTaskName").hide();
        $("#errorTaskDiscription").hide();
            var editUser=$("#task1").val();
            var editDisc=$("#task2").val();
            if(editUser ==""){
              $("#errorTaskName").show();
                $("#errorTaskName").css('color','red');
            }else{
              $("#errorTaskName").hide();
              result["taskName"] = editUser
            }
          if(editDisc=="")  {
            $("#errorTaskDiscription").show();
            $("#errorTaskDiscription").css('color','red')
            }
            else{
              $("#errorTaskDiscription").hide();
              result["taskDiscription"] = editDisc
            }
          
          result["taskId"] = $("#edit").attr("value")
           console.log(result);
            if(editUser !="" && editDisc !=""){
              $.ajax({
        url:'/updateTask',
        method: "PUT",
        data:JSON.stringify(result),
        dataType: 'json',
    contentType: 'application/json',
        success: function (result, status) {
           console.log(result);
           $("#myModal").modal('hide')
           getTaskDetails()
        }
      
      });
            }

    })
</script>

</body>
  </html>